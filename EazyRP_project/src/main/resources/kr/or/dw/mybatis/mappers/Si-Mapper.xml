<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.dw.dao.SiDAO">

<sql id="search">
		<if test="searchType == 'd'.toString()">
			AND e_name LIKE '%' || #{keyword} || '%'
		</if>
		<if test="searchType == 't'.toString()">
			AND wh_name LIKE '%' || #{keyword} || '%'
		</if>
		<if test="searchType == 'p'.toString()">
			AND progress LIKE '%' || #{keyword} || '%'
		</if>
		<if test="searchType == 'all'.toString()">
			AND (
			e_name LIKE '%' || #{keyword} || '%'
			OR
			wh_name LIKE '%' || #{keyword} || '%'
			OR
			progress LIKE '%' || #{keyword} || '%'
			)
		</if>
	</sql>


<select id="selectSiList" resultType="Map">
SELECT s2.si_no
	  ,s.sys_regdate 
	  ,e.e_name e_name
	  ,s2.shipdate 
	  ,s2.progress 
	  ,s2.enabled 
	  ,w.wh_name wh_name
	  ,s2.quantity 
	  ,s2.files 
	  ,f.fc_name fc_name
	  ,s.sys_up 
	  ,s.sys_updatedate 
	  ,p.pr_name 
  FROM si s, emp e, warehouse w, fc f ,product p ,SIDETAIL s2 
 WHERE s2.emp_no = e.emp_no
   AND s2.wh_no = w.wh_no
   AND s2.fc_no = f.fc_no
   AND s2.pr_no = p.pr_no
   AND s.SI_NO = s2.SI_NO
    <include refid="search"/>
</select>
	
<select id="selectSearchSiListCount" resultType="int">
	SELECT COUNT(*)
	FROM sidetail s, emp e, warehouse w, fc f
	 WHERE 1=1 
   AND s.emp_no = e.emp_no
   AND s.wh_no = w.wh_no
   AND s.fc_no = f.fc_no
	<include refid="search"/>
</select>	
	
<!-- 	<select id="selectSiDetail" resultType="Map"> -->
<!-- 		SELECT s.si_no -->
<!-- 	  ,s.sys_regdate  -->
<!-- 	  ,e.e_name e_name -->
<!-- 	  ,s.shipdate  -->
<!-- 	  ,s.progress  -->
<!-- 	  ,s.enabled  -->
<!-- 	  ,w.wh_name wh_name -->
<!-- 	  ,s.quantity  -->
<!-- 	  ,s.files  -->
<!-- 	  ,f.fc_name fc_name -->
<!-- 	  ,f.fc_no -->
<!-- 	  ,s.sys_up  -->
<!-- 	  ,s.sys_updatedate  -->
<!-- 	  ,e.emp_no  -->
<!--   FROM si s, emp e, warehouse w, fc f -->
<!--  WHERE s.emp_no = e.emp_no -->
<!--    AND s.si_no = #{si_no} -->
<!--    AND s.wh_no = w.wh_no -->
<!--    AND s.fc_no = f.fc_no -->
<!-- 	</select> -->
<select id="selectSiDetail" resultType="Map">
	SELECT s2.si_no
	  ,s.sys_regdate 
	  ,e.e_name e_name
	  ,s2.shipdate 
	  ,s2.progress 
	  ,s2.enabled 
	  ,w.wh_name wh_name
	  ,s2.quantity 
	  ,s2.files 
	  ,f.fc_name fc_name
	  ,s.sys_up 
	  ,s.sys_updatedate 
	  ,p.pr_name 
	  ,e.emp_no
	  ,f.fc_no
  FROM si s, emp e, warehouse w, fc f ,product p ,SIDETAIL s2 
 WHERE s2.emp_no = e.emp_no
   AND s2.wh_no = w.wh_no
   AND s2.fc_no = f.fc_no
   AND s2.pr_no = p.pr_no
   AND s.SI_NO = s2.SI_NO
   AND s2.SI_NO = #{SI_NO}
</select>	
	
	
<select id="forSiList" resultType="Map">
 SELECT s2.SI_NO ,w.WH_NAME, e.E_NAME ,s.SYS_REGDATE ,s2.SHIPDATE 
   ,s2.QUANTITY ,s.SYS_UP 
   FROM SI s , WAREHOUSE w ,EMP e,SIDETAIL s2  
   WHERE s2.WH_NO = w.WH_NO 
   AND s2.EMP_NO = e.EMP_NO 
   AND s.SI_NO = s2.SI_NO 
   AND s2.SI_NO = #{SI_NO}
 </select>
	
</mapper>