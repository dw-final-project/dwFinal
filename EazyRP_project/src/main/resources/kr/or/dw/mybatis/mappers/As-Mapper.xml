<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.dw.dao.AsDAO">

	<!-- 셀렉트바 검색 -->
	<sql id="search">
		<if test="searchType == 'p'.toString()">
			AND progress LIKE '%' || #{keyword} || '%'
		</if>
		<if test="searchType == 'c'.toString()">
			AND content LIKE '%' || #{keyword} || '%'
		</if>
		<if test="searchType == 'n'.toString()">
			AND e_name LIKE '%' || #{keyword} || '%'
		</if>
		<if test="searchType == 'all'.toString()">
			AND (
			progress LIKE '%' || #{keyword} || '%'
			OR
			content LIKE '%' || #{keyword} || '%'
			)
			OR
			e_name LIKE '%' || #{keyword} || '%'
			)
		</if>
	</sql> 
	
	<!-- contact -->
	<select id="selectAsList" resultType="Map">
		SELECT a.*, e.e_name e_name
		  FROM asmanage a, emp e
		 WHERE a.emp_no = e.emp_no	
	  ORDER BY a.as_no
	</select>
	
	
	<select id="selectAsListCount" resultType="int">
		SELECT COUNT(*)
		  FROM asmanage a, emp e
		 WHERE a.emp_no = e.emp_no	
<!-- 		 <include refid="search"/> -->
	</select>

	<insert id="asRegist">
		INSERT INTO asmanage VALUES (
		'AS_' || LPAD(asmange_seq.nextVal, 3, '0'),
		 sysdate,
		#{emp_no},
		'0',
		sysdate,
		sysdate,
		#{emp_no},
		sysdate,
		#{emp_no},
		#{asprice},
		#{content}
		)
	</insert>

	<select id="selectAsDetail" resultType="Map">
		SELECT a.*, e.e_name e_name
		  FROM asmanage a, emp e
		 WHERE a.emp_no = e.emp_no	
		   AND a.as_no = #{as_no}
	</select>

	<update id="modifyAs">
		UPDATE asmanage SET 
							repairdate = #{repairdate},
							compldate = #{compldate},
							progress = #{progress},
							asprice = #{asprice},
							content = #{content},
							sys_up = #{emp_no}
					WHERE as_no = #{as_no} 
	</update>

	<delete id="removeAs">
		DELETE FROM asmanage 
		WHERE as_no = #{as_no} 
	</delete>
	
</mapper>