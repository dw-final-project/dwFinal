<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.dw.dao.ProfitLossDAO">

	<sql id="search">
		<if test="cri2.searchType1 == 'l'.toString()">
			AND amount <![CDATA[<]]> 0
		</if>
		<if test="cri2.searchType1 == 'p'.toString()">
			AND amount <![CDATA[>]]> 0
		</if>
		
		<if test="cri2.searchType2 != 'all'.toString() and cri2.searchType2 != null">
			AND tr_gb LIKE '%' || #{cri2.searchType2} || '%'
		</if>
		
		<if test="cri2.startDate != ''.toString() and cri2.endDate != ''.toString()">
			AND sys_regdate BETWEEN #{cri2.startDate} AND #{cri2.endDate}
		</if>
		<if test="cri2.startDate != ''.toString() and cri2.endDate == ''.toString()">
			AND sys_regdate <![CDATA[>]]> #{cri2.startDate}
		</if>
		<if test="cri2.startDate == ''.toString() and cri2.endDate != ''.toString()">
			AND sys_regdate <![CDATA[<]]> #{cri2.endDate}
		</if>
	</sql>
	
	<select id="getHistory" resultType="tr_history">
		SELECT * FROM tr_history WHERE c_no = #{c_no}
		<include refid="search"/>
		ORDER BY th_no DESC
	</select>
	
	<select id="getTotalCount" resultType="int">
		SELECT COUNT(*) FROM tr_history WHERE c_no = #{c_no}
		<include refid="search"/>
	</select>
	
	<insert id="tr">
		INSERT INTO tr_history VALUES(
			'TH_' || LPAD(th_no_seq.nextval, 4, '0'),
			#{date},
			#{date},
			'C000001',
			0,
			'FC_003',
			#{amount},
			'',
			'o',
			'Y',
			'/product/orderDetail.do?o_no=' || #{order.o_no},
			#{order.quantity},
			'',
			'AC_001',
			'T_001',
			'',
			'',
			'추가',
			'',
			''
		)
	</insert>
	
	
</mapper>